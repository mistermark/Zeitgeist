!function(e){e.fn.flickrHeist=function(t){"use strict";var o=e.extend({},e.fn.flickrHeist.defaults,t),a={REST_URL:"http://www.flickr.com/services/rest/",SEARCH:"flickr.photos.search",GETINFO:"flickr.photos.getInfo",APIKEY:"ce2cebcf703d8ab2bdbd5342f16ebcaa",FORMAT:"json"};a.PARAMS={SEARCH:{api_key:a.APIKEY,method:a.SEARCH,format:a.FORMAT,tags:o.tags,safe_search:o.safe_search,pages:"1",per_page:o.number_photos,nojsoncallback:"1",sort:o.sortby,extras:o.size+",geo,owner_name",has_geo:"1",min_upload_date:o.min_date},GETINFO:{api_key:a.APIKEY,photo_id:null,format:a.FORMAT}};var s={status:null,target:this,today:(new Date).setHours(0,0,0,0),jsonmodel:{creation_date:null,real_total:null,items:[]},photoSearchUrl:a.REST_URL+"?"+e.param(a.PARAMS.SEARCH)};s.jsonmodel.creation_date=s.today;var l=function(){s.status="initialized",d()},r=function(e){return localStorage&&null!==localStorage.getItem("flickrHeist")?!0:e},i=function(e){return r(e)===!0?JSON.parse(localStorage.getItem("flickrHeist")):e},n=function(e){(r(e)!==!0||e.creation_date!==s.today)&&localStorage.setItem("flickrHeist",JSON.stringify(e))},c=function(){var e=i(s.jsonmodel);return r()===!0&&o.random===!0?Math.floor(Math.random()*e.real_total):void 0},d=function(){s.status="fetching-start",r(s.jsonmodel)===!0&&o.debug!==!0?u(i()):e.ajax({url:s.photoSearchUrl,dataType:"json",data:JSON,error:function(e,t){throw new Error(t)},success:function(t){s.jsonmodel.real_total=0,e.each(t.photos.photo,function(e,t){void 0!==t[o.size]&&(s.jsonmodel.real_total++,s.jsonmodel.items.push({id:t.id,details:{src:t[o.size],title:t.title,ownername:"",place_id:t.place_id,geo:{city:"",country:""},page_url:""}}))}),o.debug!==!0&&n(s.jsonmodel)},complete:function(){u(s.jsonmodel)}})},u=function(e){s.status="drophoto";var t=Handlebars.compile(o.phototemplate);s.target.html(t(e.items[c(e)])),m(e)},m=function(){e.isFunction(o.complete)&&o.complete.call()};return l()},e.fn.flickrHeist.defaults={tags:"zeitgeist",safe_search:"0",number_photos:"31",sortby:"interestingness-desc",random:!0,size:"url_c",min_date:"1330560000",debug:!1,phototemplate:'<div class="cover-image" style="background-image: url({{details.src}})">',creditstemplate:'<div class="cover-details"><ul class="clearfix"><li class="cover-owner">{{details.title}}</li><li class="cover-location">{{details.place_id}}</li></ul></div>',complete:null}}(jQuery);